{"version":3,"file":"logging.js","sources":["../../../../packages/logging/src/logger.ts","../../../../packages/logging/src/loglevel.ts","../../../../packages/logging/src/listeners.ts"],"sourcesContent":["import { LogListener } from \"./listeners\";\nimport { LogEntry } from \"./logentry\";\nimport { LogLevel } from \"./loglevel\";\n\n/**\n * Class used to subscribe ILogListener and log messages throughout an application\n *\n */\nexport class Logger {\n\n    private static _instance: LoggerImpl;\n\n    /**\n     * Gets or sets the active log level to apply for log filtering\n     */\n    public static get activeLogLevel(): LogLevel {\n        return Logger.instance.activeLogLevel;\n    }\n\n    public static set activeLogLevel(value: LogLevel) {\n        Logger.instance.activeLogLevel = value;\n    }\n\n    private static get instance(): LoggerImpl {\n        if (Logger._instance === undefined || Logger._instance === null) {\n            Logger._instance = new LoggerImpl();\n        }\n        return Logger._instance;\n    }\n\n    /**\n     * Adds ILogListener instances to the set of subscribed listeners\n     *\n     * @param listeners One or more listeners to subscribe to this log\n     */\n    public static subscribe(...listeners: LogListener[]): void {\n        listeners.map(listener => Logger.instance.subscribe(listener));\n    }\n\n    /**\n     * Clears the subscribers collection, returning the collection before modifiction\n     */\n    public static clearSubscribers(): LogListener[] {\n        return Logger.instance.clearSubscribers();\n    }\n\n    /**\n     * Gets the current subscriber count\n     */\n    public static get count(): number {\n        return Logger.instance.count;\n    }\n\n    /**\n     * Writes the supplied string to the subscribed listeners\n     *\n     * @param message The message to write\n     * @param level [Optional] if supplied will be used as the level of the entry (Default: LogLevel.Info)\n     */\n    public static write(message: string, level: LogLevel = LogLevel.Info) {\n        Logger.instance.log({ level: level, message: message });\n    }\n\n    /**\n     * Writes the supplied string to the subscribed listeners\n     *\n     * @param json The json object to stringify and write\n     * @param level [Optional] if supplied will be used as the level of the entry (Default: LogLevel.Info)\n     */\n    public static writeJSON(json: any, level: LogLevel = LogLevel.Info) {\n        this.write(JSON.stringify(json), level);\n    }\n\n    /**\n     * Logs the supplied entry to the subscribed listeners\n     *\n     * @param entry The message to log\n     */\n    public static log(entry: LogEntry) {\n        Logger.instance.log(entry);\n    }\n\n    /**\n     * Logs an error object to the subscribed listeners\n     * \n     * @param err The error object\n     */\n    public static error(err: Error) {\n        Logger.instance.log({ data: err, level: LogLevel.Error, message: err.message });\n    }\n}\n\nclass LoggerImpl {\n\n    constructor(public activeLogLevel: LogLevel = LogLevel.Warning, private subscribers: LogListener[] = []) { }\n\n    public subscribe(listener: LogListener): void {\n        this.subscribers.push(listener);\n    }\n\n    public clearSubscribers(): LogListener[] {\n        const s = this.subscribers.slice(0);\n        this.subscribers.length = 0;\n        return s;\n    }\n\n    public get count(): number {\n        return this.subscribers.length;\n    }\n\n    public write(message: string, level: LogLevel = LogLevel.Info) {\n        this.log({ level: level, message: message });\n    }\n\n    public log(entry: LogEntry) {\n        if (entry !== undefined && this.activeLogLevel <= entry.level) {\n            this.subscribers.map(subscriber => subscriber.log(entry));\n        }\n    }\n}\n","/**\n * A set of logging levels\n */\nexport const enum LogLevel {\n    Verbose = 0,\n    Info = 1,\n    Warning = 2,\n    Error = 3,\n    Off = 99,\n}\n","import { LogEntry } from \"./logentry\";\nimport { LogLevel } from \"./loglevel\";\n\n/**\n * Interface that defines a log listner\n *\n */\nexport interface LogListener {\n    /**\n     * Any associated data that a given logging listener may choose to log or ignore\n     *\n     * @param entry The information to be logged\n     */\n    log(entry: LogEntry): void;\n}\n\n/**\n * Implementation of LogListener which logs to the console\n *\n */\nexport class ConsoleListener implements LogListener {\n\n    /**\n     * Any associated data that a given logging listener may choose to log or ignore\n     *\n     * @param entry The information to be logged\n     */\n    public log(entry: LogEntry): void {\n\n        const msg = this.format(entry);\n\n        switch (entry.level) {\n            case LogLevel.Verbose:\n            case LogLevel.Info:\n                console.log(msg);\n                break;\n            case LogLevel.Warning:\n                console.warn(msg);\n                break;\n            case LogLevel.Error:\n                console.error(msg);\n                break;\n        }\n    }\n\n    /**\n     * Formats the message\n     *\n     * @param entry The information to format into a string\n     */\n    private format(entry: LogEntry): string {\n        const msg = [];\n        msg.push(\"Message: \" + entry.message);\n        if (entry.data !== undefined) {\n            try {\n                msg.push(\" Data: \" + JSON.stringify(entry.data));\n            } catch (e) {\n                msg.push(` Data: Error in stringify of supplied data ${e}`);\n            }\n        }\n\n        return msg.join(\"\");\n    }\n}\n\n/**\n * Implementation of LogListener which logs to the supplied function\n *\n */\nexport class FunctionListener implements LogListener {\n\n    /**\n     * Creates a new instance of the FunctionListener class\n     *\n     * @constructor\n     * @param  method The method to which any logging data will be passed\n     */\n    constructor(private method: (entry: LogEntry) => void) { }\n\n    /**\n     * Any associated data that a given logging listener may choose to log or ignore\n     *\n     * @param entry The information to be logged\n     */\n    public log(entry: LogEntry): void {\n        this.method(entry);\n    }\n}\n"],"names":[],"mappings":"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"}