{"version":3,"sources":["utils/positioner/Popper.tsx"],"names":["useIsomorphicLayoutEffect","Ref","isRefObject","PopperJs","React","isBrowser","getBoundary","getScrollParent","getPlacement","applyRtlToOffset","reactInstanceKey","getReactInstanceKey","elm","k","indexOf","hasAutofocusProp","node","nodeName","pendingProps","autoFocus","hasAutofocusFilter","NodeFilter","FILTER_ACCEPT","FILTER_SKIP","usePopperInitialPositionFix","contentRef","originalStateRef","useRef","process","env","NODE_ENV","useEffect","current","contentNode","treeWalker","ownerDocument","createTreeWalker","SHOW_ELEMENT","acceptNode","nextNode","currentNode","console","warn","join","useMemo","patch","popperInstance","originalForceUpdate","forceUpdate","isFirstRun","state","elements","popper","style","modifier","name","enabled","phase","effect","requires","useDeepMemo","memoFn","key","ref","value","useFirstMount","isFirst","useUpdateIsomorphicLayoutEffect","deps","isFirstMount","Popper","props","align","children","flipBoundary","userModifiers","modifiers","offset","overflowBoundary","pointerTargetRef","popperRef","position","positionFixed","positioningDependencies","rtl","targetRef","unstable_disableTether","unstable_pinned","proposedPlacement","popperInstanceRef","popperInitialPositionFix","latestPlacement","useState","computedPlacement","setComputedPlacement","computedModifiers","options","createInstance","useCallback","reference","handleUpdate","placement","hasDocument","scrollParentElement","hasScrollableElement","body","hasPointer","flipVariations","boundary","strategy","element","altAxis","tether","altBoundary","fn","filter","Boolean","onFirstUpdate","createPopper","destroyInstance","destroy","scheduleUpdate","update","useImperativeHandle","updatePosition","child","Children","only","defaultProps"],"mappings":"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","sourcesContent":["import { useIsomorphicLayoutEffect } from '@fluentui/react-bindings';\nimport { Ref, isRefObject } from '@fluentui/react-component-ref';\nimport * as PopperJs from '@popperjs/core';\nimport * as _ from 'lodash';\nimport * as React from 'react';\n\nimport { isBrowser } from '../isBrowser';\nimport { getBoundary } from './getBoundary';\nimport { getScrollParent } from './getScrollParent';\nimport { getPlacement, applyRtlToOffset } from './positioningHelper';\nimport { PopperModifiers, PopperProps, PopperPositionFix, PopperJsInstance } from './types';\n\nlet reactInstanceKey: string;\n\nconst getReactInstanceKey = (elm: Node): string => {\n  if (!reactInstanceKey) {\n    for (const k in elm) {\n      if (k.indexOf('__reactInternalInstance$') === 0) {\n        reactInstanceKey = k;\n        break;\n      }\n    }\n  }\n\n  return reactInstanceKey;\n};\n\nconst hasAutofocusProp = (node: Node): boolean | undefined => {\n  // https://github.com/facebook/react/blob/848bb2426e44606e0a55dfe44c7b3ece33772485/packages/react-dom/src/client/ReactDOMHostConfig.js#L157-L166\n  return (\n    (node.nodeName === 'BUTTON' ||\n      node.nodeName === 'INPUT' ||\n      node.nodeName === 'SELECT' ||\n      node.nodeName === 'TEXTAREA') &&\n    node[getReactInstanceKey(node)].pendingProps.autoFocus\n  );\n};\n\nfunction hasAutofocusFilter(node: Node) {\n  return hasAutofocusProp(node) ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_SKIP;\n}\n\n// We are setting the position to `fixed` in the first effect\n// To prevent scroll jumps in case of the content with managed focus\n// Modifier sets the position to `fixed` before all other modifier effects\n// Patch updates `forceUpdate` Popper function\n// which restores the original position before the first forceUpdate call\nconst usePopperInitialPositionFix = (contentRef: React.MutableRefObject<HTMLElement>): PopperPositionFix => {\n  const originalStateRef = React.useRef<string>('absolute');\n\n  if (process.env.NODE_ENV !== 'production') {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    React.useEffect(() => {\n      if (contentRef.current) {\n        const contentNode = contentRef.current;\n        const treeWalker = contentNode.ownerDocument?.createTreeWalker(contentNode, NodeFilter.SHOW_ELEMENT, {\n          acceptNode: hasAutofocusFilter,\n        });\n\n        while (treeWalker.nextNode()) {\n          const node = treeWalker.currentNode;\n          // eslint-disable-next-line no-console\n          console.warn('<Popper>:', node);\n          // eslint-disable-next-line no-console\n          console.warn(\n            [\n              '<Popper>: ^ this node contains \"autoFocus\" prop on a React element. This can break the initial',\n              'positioning of an element and cause a window jump effect. This issue occurs because React polyfills',\n              '\"autoFocus\" behavior to solve inconsistencies between different browsers:',\n              'https://github.com/facebook/react/issues/11851#issuecomment-351787078',\n              '\\n',\n              'However, \".focus()\" in this case occurs before any other React effects will be executed',\n              '(React.useEffect(), componentDidMount(), etc.) and we can not prevent this behavior. If you really',\n              'want to use \"autoFocus\" please add \"position: fixed\" to styles of the element that is wrapped by',\n              '\"Popper\".',\n              `In general, it's not recommended to use \"autoFocus\" as it may break accessibility aspects:`,\n              'https://github.com/jsx-eslint/eslint-plugin-jsx-a11y/blob/master/docs/rules/no-autofocus.md',\n              '\\n',\n              'We suggest to use the \"trapFocus\" prop on Fluent components or a catch \"ref\" and then use',\n              '\"ref.current.focus\" in React.useEffect():',\n              'https://reactjs.org/docs/refs-and-the-dom.html#adding-a-ref-to-a-dom-element',\n            ].join(' '),\n          );\n        }\n      }\n      // We run this check once, no need to add deps here\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n  }\n\n  return React.useMemo(\n    () => ({\n      patch: (popperInstance: PopperJsInstance) => {\n        const originalForceUpdate = popperInstance.forceUpdate;\n        popperInstance.isFirstRun = true;\n        popperInstance.forceUpdate = () => {\n          if (popperInstance.isFirstRun) {\n            popperInstance.state.elements.popper.style['position'] = originalStateRef.current;\n            popperInstance.isFirstRun = false;\n          }\n          originalForceUpdate();\n        };\n      },\n      modifier: {\n        name: 'positionStyleFix',\n        enabled: true,\n        phase: 'afterWrite' as PopperJs.ModifierPhases,\n        effect: ({ state }: { state: Partial<PopperJs.State> }) => {\n          originalStateRef.current = state.elements.popper.style['position'];\n          state.elements.popper.style['position'] = 'fixed';\n          return () => {};\n        },\n        requires: [],\n      },\n    }),\n    [],\n  );\n};\n\n/**\n * Memoize a result using deep equality. This hook has two advantages over\n * React.useMemo: it uses deep equality to compare memo keys, and it guarantees\n * that the memo function will only be called if the keys are unequal.\n * React.useMemo cannot be relied on to do this, since it is only a performance\n * optimization (see https://reactjs.org/docs/hooks-reference.html#usememo).\n *\n * Copied from https://github.com/apollographql/react-apollo/blob/master/packages/hooks/src/utils/useDeepMemo.ts.\n */\nfunction useDeepMemo<TKey, TValue>(memoFn: () => TValue, key: TKey): TValue {\n  const ref = React.useRef<{ key: TKey; value: TValue }>();\n\n  if (!ref.current || !_.isEqual(key, ref.current.key)) {\n    ref.current = { key, value: memoFn() };\n  }\n\n  return ref.current.value;\n}\n\n/** Checks if components was mounted the first time. */\nfunction useFirstMount(): boolean {\n  const isFirst = React.useRef(true);\n\n  if (isFirst.current) {\n    isFirst.current = false;\n    return true;\n  }\n\n  return isFirst.current;\n}\n\n/** Executes useIsomorphicLayoutEffect during only updates. */\nconst useUpdateIsomorphicLayoutEffect: typeof React.useLayoutEffect = (effect, deps) => {\n  const isFirstMount = useFirstMount();\n\n  useIsomorphicLayoutEffect(() => {\n    if (!isFirstMount) {\n      return effect();\n    }\n  }, deps);\n};\n\n/**\n * Popper relies on the 3rd party library [Popper.js](https://github.com/FezVrasta/popper.js) for positioning.\n */\nexport const Popper: React.FunctionComponent<PopperProps> = props => {\n  const {\n    align,\n    children,\n    enabled,\n    flipBoundary,\n    modifiers: userModifiers,\n    offset,\n    overflowBoundary,\n    pointerTargetRef,\n    popperRef,\n    position,\n    positionFixed,\n    positioningDependencies = [],\n    rtl,\n    targetRef,\n    unstable_disableTether,\n    unstable_pinned,\n  } = props;\n\n  const proposedPlacement = getPlacement({ align, position, rtl });\n\n  const popperInstanceRef = React.useRef<PopperJsInstance>();\n  const contentRef = React.useRef<HTMLElement>(null);\n  const popperInitialPositionFix = usePopperInitialPositionFix(contentRef);\n\n  const latestPlacement = React.useRef<PopperJs.Placement>(proposedPlacement);\n  const [computedPlacement, setComputedPlacement] = React.useState<PopperJs.Placement>(proposedPlacement);\n\n  const computedModifiers = useDeepMemo<any, PopperModifiers>(\n    () => [\n      offset && {\n        name: 'offset',\n        options: { offset: rtl ? applyRtlToOffset(offset) : offset },\n      },\n      ...userModifiers,\n    ],\n    [offset, flipBoundary, overflowBoundary, userModifiers],\n  );\n\n  const createInstance = React.useCallback(() => {\n    const reference: Element | PopperJs.VirtualElement =\n      targetRef && isRefObject(targetRef)\n        ? (targetRef as React.RefObject<Element>).current\n        : (targetRef as PopperJs.VirtualElement);\n\n    if (!enabled || !reference || !contentRef.current) {\n      return;\n    }\n\n    const handleUpdate = ({ state }: { state: Partial<PopperJs.State> }) => {\n      // PopperJS performs computations that might update the computed placement: auto positioning, flipping the\n      // placement in case the popper box should be rendered at the edge of the viewport and does not fit\n      if (state.placement !== latestPlacement.current) {\n        latestPlacement.current = state.placement;\n        setComputedPlacement(state.placement);\n      }\n    };\n\n    const hasDocument = isBrowser();\n    const scrollParentElement: Node | null = hasDocument ? getScrollParent(contentRef.current) : null;\n\n    const hasScrollableElement = scrollParentElement\n      ? scrollParentElement !== scrollParentElement.ownerDocument.body\n      : false;\n    const hasPointer = !!(pointerTargetRef && pointerTargetRef.current);\n\n    const modifiers: PopperModifiers = [\n      { name: 'flip', options: { flipVariations: true } },\n\n      /**\n       * unstable_pinned disables the flip modifier by setting flip.enabled to false; this\n       * disables automatic repositioning of the popper box; it will always be placed according to\n       * the values of `align` and `position` props, regardless of the size of the component, the\n       * reference element or the viewport.\n       */\n      unstable_pinned && { name: 'flip', enabled: false },\n\n      /**\n       * When the popper box is placed in the context of a scrollable element, we need to set\n       * preventOverflow.escapeWithReference to true and flip.boundariesElement to 'scrollParent'\n       * (default is 'viewport') so that the popper box will stick with the targetRef when we\n       * scroll targetRef out of the viewport.\n       */\n      hasScrollableElement && { name: 'flip', options: { boundary: 'clippingParents' } },\n      hasScrollableElement && { name: 'preventOverflow', options: { boundary: 'clippingParents' } },\n    ];\n\n    const options: PopperJs.Options = {\n      placement: proposedPlacement,\n      strategy: positionFixed ? 'fixed' : 'absolute',\n      modifiers: [\n        ...(modifiers as PopperJs.Options['modifiers']),\n\n        ...computedModifiers,\n\n        /**\n         * This modifier is necessary in order to render the pointer. Refs are resolved in effects, so it can't be\n         * placed under computed modifiers. Deep merge is not required as this modifier has only these properties.\n         */\n        {\n          name: 'arrow',\n          enabled: hasPointer,\n          options: {\n            element: pointerTargetRef && pointerTargetRef.current,\n          },\n        },\n\n        /**\n         * This modifier is necessary to retain behaviour from popper v1 where untethered poppers are allowed by\n         * default. i.e. popper is still rendered fully in the viewport even if anchor element is no longer in the\n         * viewport.\n         */\n        unstable_disableTether && {\n          name: 'preventOverflow',\n          options: { altAxis: unstable_disableTether === 'all', tether: false },\n        },\n\n        flipBoundary && {\n          name: 'flip',\n          options: {\n            altBoundary: true,\n            boundary: getBoundary(contentRef.current, flipBoundary),\n          },\n        },\n        overflowBoundary && {\n          name: 'preventOverflow',\n          options: {\n            altBoundary: true,\n            boundary: getBoundary(contentRef.current, overflowBoundary),\n          },\n        },\n\n        {\n          name: 'onUpdate',\n          enabled: true,\n          phase: 'afterWrite' as PopperJs.ModifierPhases,\n          fn: handleUpdate,\n        },\n        popperInitialPositionFix.modifier,\n      ].filter(Boolean),\n      onFirstUpdate: state => handleUpdate({ state }),\n    };\n\n    popperInstanceRef.current = PopperJs.createPopper(reference, contentRef.current, options);\n    popperInitialPositionFix.patch(popperInstanceRef.current);\n  }, [\n    contentRef,\n    computedModifiers,\n    enabled,\n    flipBoundary,\n    overflowBoundary,\n    pointerTargetRef,\n    positionFixed,\n    proposedPlacement,\n    targetRef,\n    unstable_disableTether,\n    unstable_pinned,\n    popperInitialPositionFix,\n  ]);\n\n  const destroyInstance = React.useCallback(() => {\n    if (popperInstanceRef.current) {\n      popperInstanceRef.current.destroy();\n      popperInstanceRef.current = null;\n    }\n  }, []);\n\n  const scheduleUpdate = React.useCallback(() => {\n    if (popperInstanceRef.current) {\n      popperInstanceRef.current.update();\n    }\n  }, []);\n\n  React.useImperativeHandle(\n    popperRef,\n    () => ({\n      updatePosition: scheduleUpdate,\n    }),\n    [scheduleUpdate],\n  );\n\n  useIsomorphicLayoutEffect(() => {\n    createInstance();\n    return destroyInstance;\n  }, [createInstance]);\n\n  useUpdateIsomorphicLayoutEffect(scheduleUpdate, [...positioningDependencies, computedPlacement]);\n\n  const child =\n    typeof children === 'function'\n      ? children({ placement: computedPlacement, scheduleUpdate })\n      : (children as React.ReactElement);\n\n  return child ? <Ref innerRef={contentRef}>{React.Children.only(child)}</Ref> : null;\n};\n\nPopper.defaultProps = {\n  enabled: true,\n  modifiers: [],\n  positionFixed: false,\n  positioningDependencies: [],\n};\n"],"file":"Popper.js"}