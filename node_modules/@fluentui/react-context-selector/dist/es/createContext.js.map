{"version":3,"sources":["createContext.ts"],"names":["React","calculateChangedBits","createProvider","Original","Provider","props","listeners","useRef","current","forEach","listener","value","subscribe","useCallback","push","unsubscribe","index","indexOf","splice","createElement","children","process","env","NODE_ENV","displayName","createContext","defaultValue","options","strict","context","Error","Consumer"],"mappings":"AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;;AAGA;AACA;AACA,IAAMC,oBAAoB,GAAG,SAAvBA,oBAAuB;AAAA,SAAM,CAAN;AAAA,CAA7B;;AAEA,IAAMC,cAAc,GAAG,SAAjBA,cAAiB,CAAQC,QAAR,EAA0D;AAC/E,MAAMC,QAA8C,GAAG,SAAjDA,QAAiD,CAAAC,KAAK,EAAI;AAC9D,QAAMC,SAAS,GAAGN,KAAK,CAACO,MAAN,CAAuC,EAAvC,CAAlB,CAD8D,CAG9D;AACA;AACA;AACA;;AACAD,IAAAA,SAAS,CAACE,OAAV,CAAkBC,OAAlB,CAA0B,UAAAC,QAAQ;AAAA,aAAIA,QAAQ,CAACL,KAAK,CAACM,KAAP,CAAZ;AAAA,KAAlC,EAP8D,CAS9D;;AACA,QAAMC,SAAS,GAAGZ,KAAK,CAACa,WAAN,CAAkB,UAACH,QAAD,EAAsC;AACxEJ,MAAAA,SAAS,CAACE,OAAV,CAAkBM,IAAlB,CAAuBJ,QAAvB;;AAEA,UAAMK,WAAW,GAAG,SAAdA,WAAc,GAAM;AACxB,YAAMC,KAAK,GAAGV,SAAS,CAACE,OAAV,CAAkBS,OAAlB,CAA0BP,QAA1B,CAAd;AACAJ,QAAAA,SAAS,CAACE,OAAV,CAAkBU,MAAlB,CAAyBF,KAAzB,EAAgC,CAAhC;AACD,OAHD;;AAKA,aAAOD,WAAP;AACD,KATiB,EASf,EATe,CAAlB;AAWA,wBAAOf,KAAK,CAACmB,aAAN,CAAoBhB,QAApB,EAA8B;AAAEQ,MAAAA,KAAK,EAAE;AAAEC,QAAAA,SAAS,EAATA,SAAF;AAAaD,QAAAA,KAAK,EAAEN,KAAK,CAACM;AAA1B;AAAT,KAA9B,EAA4EN,KAAK,CAACe,QAAlF,CAAP;AACD,GAtBD;AAwBA;;;AACA,MAAIC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAA7B,EAA2C;AACzCnB,IAAAA,QAAQ,CAACoB,WAAT,GAAuB,0BAAvB;AACD;;AAED,SAAOpB,QAAP;AACD,CA/BD;;AAiCA,OAAO,IAAMqB,aAAa,GAAG,SAAhBA,aAAgB,CAAQC,YAAR,EAA6BC,OAA7B,EAAoF;AAAA,MAAvDA,OAAuD;AAAvDA,IAAAA,OAAuD,GAAvB,EAAuB;AAAA;;AAAA,iBACrFA,OADqF;AAAA,iCACvGC,MADuG;AAAA,MACvGA,MADuG,gCAC9F,IAD8F;AAG/G,MAAMC,OAAO,gBAAG7B,KAAK,CAACyB,aAAN,CACd;AACE,QAAIb,SAAJ,GAAgB;AACd,UAAIgB,MAAJ,EAAY;AACV;AACA,cAAM,IAAIE,KAAJ,CACJT,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAAzB,GACI,EADJ,gFADI,CAAN;AAKD;AAED;;;AACA,aAAO;AAAA,eAAM,YAAM,CAAE,CAAd;AAAA,OAAP;AACD,KAbH;;AAcEZ,IAAAA,KAAK,EAAEe;AAdT,GADc,EAiBdzB,oBAjBc,CAAhB;AAmBA4B,EAAAA,OAAO,CAACzB,QAAR,GAAmBF,cAAc,CAAQ2B,OAAO,CAACzB,QAAhB,CAAjC,CAtB+G,CAwB/G;;AACA,SAAOyB,OAAO,CAACE,QAAf;AAEA,SAAQF,OAAR;AACD,CA5BM","sourcesContent":["import * as React from 'react';\nimport { Context, ContextListener, ContextValue, CreateContextOptions } from './types';\n\n// Stops React Context propagation\n// https://github.com/facebook/react/blob/95bd7aad7daa80c381faa3215c80b0906ab5ead5/packages/react-reconciler/src/ReactFiberBeginWork.js#L2656\nconst calculateChangedBits = () => 0;\n\nconst createProvider = <Value>(Original: React.Provider<ContextValue<Value>>) => {\n  const Provider: React.FC<React.ProviderProps<Value>> = props => {\n    const listeners = React.useRef<ContextListener<Value>[]>([]);\n\n    // We call listeners in render intentionally. Listeners are not technically pure, but\n    // otherwise we can't get benefits from concurrent mode.\n    //\n    // We make sure to work with double or more invocation of listeners.\n    listeners.current.forEach(listener => listener(props.value));\n\n    // Disables updates propogation for React Context as `value` is always shallow equal\n    const subscribe = React.useCallback((listener: ContextListener<Value>) => {\n      listeners.current.push(listener);\n\n      const unsubscribe = () => {\n        const index = listeners.current.indexOf(listener);\n        listeners.current.splice(index, 1);\n      };\n\n      return unsubscribe;\n    }, []);\n\n    return React.createElement(Original, { value: { subscribe, value: props.value } }, props.children);\n  };\n\n  /* istanbul ignore else */\n  if (process.env.NODE_ENV !== 'production') {\n    Provider.displayName = 'ContextSelector.Provider';\n  }\n\n  return Provider;\n};\n\nexport const createContext = <Value>(defaultValue: Value, options: CreateContextOptions = {}): Context<Value> => {\n  const { strict = true } = options;\n\n  const context = React.createContext<ContextValue<Value>>(\n    {\n      get subscribe() {\n        if (strict) {\n          /* istanbul ignore next */\n          throw new Error(\n            process.env.NODE_ENV === 'production'\n              ? ''\n              : `Please use <Provider /> component from \"@fluentui/react-context-selector\"`,\n          );\n        }\n\n        /* istanbul ignore next */\n        return () => () => {};\n      },\n      value: defaultValue,\n    },\n    calculateChangedBits,\n  );\n  context.Provider = createProvider<Value>(context.Provider) as any;\n\n  // We don't support Consumer API\n  delete context.Consumer;\n\n  return (context as unknown) as Context<Value>;\n};\n"],"file":"createContext.js"}